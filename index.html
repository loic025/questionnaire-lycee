<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Grille d'auto-évaluation</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    .question { margin-bottom: 15px; }
    .responses { display: flex; gap: 10px; }
    label { display: block; margin-bottom: 5px; }
    select, input[type=text] { width: 100%; padding: 5px; margin-bottom: 10px; }
    button { padding: 10px 20px; margin-top: 20px; }
    .instructions { font-style: italic; margin-bottom: 20px; }
    .subgroup-title { font-weight: bold; margin-top: 30px; margin-bottom: 10px; }
    #finalMessage { display: none; font-size: 18px; font-weight: bold; text-align: center; margin-top: 40px; }
    #welcome { text-align: center; margin-top: 40px; }
    #welcome img { max-width: 200px; margin-bottom: 20px; }
    #questionnaireForm { display: none; }
  </style>
</head>
<body>
  <div id="welcome">
    <img src="static/logo-education.png" alt="Logo Ministère" style="float:left; margin-right:15px;">
    <p>
      Ce questionnaire est anonyme, il permet de mieux comprendre certains problèmes qui peuvent se passer entre lycéens.<br>
      Nous comptons sur toi pour répondre sincèrement et te remercions de ton aide.<br><br>
      Tu devras cocher la case qui correspond à ta réponse en tenant compte de ce qui s'est passé depuis le début de l'année scolaire.
    </p>
    <button onclick="startQuestionnaire()">Commencer</button>
  </div>

  <form id="questionnaireForm">
    <div class="question">
  <label for="nomEleve"><strong>Nom et prénom (facultatif) :</strong></label>
  <input type="text" id="nomEleve" name="nomEleve" placeholder="(Tu peux laisser vide si tu préfères)">
</div>
    <h1>Grille d'auto-évaluation</h1>
    <label>Classe :</label>
    <select name="classe" required>
      <option value="">--Choisir--</option>
      <option>2nde1</option>
      <option>2nde2</option>
      <option>1ère1</option>
      <option>1ère2</option>
      <option>Tle1</option>
      <option>Tle2</option>
      <option>2AGORA</option>
      <option>2ASSP</option>
      <option>2HRCUI</option>
      <option>2MTNE</option>
      <option>2MV</option>
      <option>1AGORA</option>
      <option>1ASSP</option>
      <option>1CIEL</option>
      <option>1MELEC</option>
      <option>1MV</option>
      <option>TAGORA</option>
      <option>TASSP</option>
      <option>TCIEL</option>
      <option>TCUI</option>
      <option>TMELEC</option>
      <option>TMV</option>
      <option>CAP1 EPC</option>
      <option>CAP1 IMTB</option>
      <option>CAP1 MV</option>
      <option>CAP2 CHB</option>
      <option>CAP2 CUI</option>
      <option>CAP2 EPC</option>
      <option>CAP2 IMTB</option>
    </select>

    <label>Sexe :</label>
    <select name="sexe" required>
      <option value="">--Choisir--</option>
      <option>F</option>
      <option>M</option>
      <option>Autre</option>
    </select>

    <label>Année de naissance :</label>
    <select name="annee" required>
      <option value="">--Choisir--</option>
      <option>2011 ou après</option>
      <option>2010</option>
      <option>2009</option>
      <option>2008</option>
      <option>2007 ou avant</option>
    </select>

    <p class="instructions">1 = Jamais &nbsp;&nbsp;&nbsp; 2 = Parfois &nbsp;&nbsp;&nbsp; 3 = Souvent &nbsp;&nbsp;&nbsp; 4 = Très souvent</p>
    <div id="questions"></div>
    <button type="submit">Envoyer</button>
  </form>

  <div id="finalMessage">
    L’auto-évaluation est terminée. Merci d’avoir participé !
  </div>

  <script>
    const questionsText = [
  "As-tu peur sur le trajet du lycée à cause d’un ou plusieurs élèves ?",
  "As-tu peur d’aller au lycée à cause d’un ou plusieurs élèves ?",
  "As-tu menti pour rester chez toi par peur de retrouver un ou plusieurs élèves au lycée ?",
  "As-tu séché les cours à cause de tes relations avec un ou plusieurs élèves ?",
  "Tes notes baissent-elles à cause de ce que tu vis au lycée ?",
  "Te sens-tu démotivé(e) à cause de ce que tu vis au lycée ?",
  "As-tu du mal à faire tes devoirs à cause de ce que tu vis au lycée ?",
  "As-tu du mal à t’endormir ou fais-tu des cauchemars à cause de ce que tu vis au lycée ?",
  "As-tu mal au ventre ou à la tête à cause de ce que tu vis au lycée ?",
  "Est-ce que tu te sens triste à cause de ce que tu vis au lycée ?",
  "Est-ce que tu te sens seul(e) au lycée ?",
  "As-tu peur d’aller en récréation à cause d’un ou plusieurs élèves ?",
  "Te mets-tu en colère ou es-tu agressif(ve) sans savoir pourquoi ?",
  "Es-tu exclu(e) des groupes de travail par un ou plusieurs élèves ?",
  "As-tu été mis(e) à l’écart dans la cour par un ou plusieurs élèves ?",
  "Manges-tu seul quand tu manges au lycée ?",
  "Est-ce qu’un ou plusieurs élèves t’empêchent de manger tranquillement au lycée ?",
  "Est-ce qu’un ou plusieurs élèves se moquent de toi ou t’insultent ?",
  "Est-ce qu’un ou plusieurs élèves font courir des rumeurs sur toi ?",
  "Est-ce qu’un ou plusieurs élèves te rabaissent ou t’humilient ?",
  "Est-ce qu’un ou plusieurs élèves t’ont déjà menacé(e) ?",
  "T’es-tu bagarré(e) avec un ou plusieurs élèves ?",
  "Est-ce qu’un ou plusieurs élèves t’ont bousculé(e) volontairement ?",
  "As-tu été agressé(e) physiquement par un ou plusieurs élèves ?",
  "Est-ce qu’un ou plusieurs élèves t’ont volé des affaires ou ont menacé de le faire ?",
  "As-tu participé à un jeu dangereux à la demande d’un ou plusieurs élèves ?",
  "As-tu été embêté(e) aux toilettes ?",
  "Est-ce qu’on a essayé de te retirer tes habits ?",
  "As-tu reçu des messages insultants ou menaçants en ligne ?",
  "Un ou plusieurs élèves font-ils circuler des photos ou messages sans ton accord ?",
  "Des photos ou vidéos intimes de toi ont-elles circulé sans ton accord ?",
  "Tes coordonnées ont-elles circulé sans ton accord ?",
  "Es-tu victime d’insultes à caractère sexuel ?",
  "As-tu subi des violences à caractère sexuel ?",
  // Nouveau bloc Oui/Non :
  "Est-ce toujours par le ou les mêmes élèves ?",
  "As-tu déjà demandé de l'aide à un(e) autre élève ?",
  "As-tu déjà demandé de l'aide à tes parents ?",
  "As-tu déjà demandé de l'aide à un personnel éducatif ?",
  // Nouveau bloc Oui/Non :
  "As-tu au moins un(e) ami(e) dans ton établissement ?",
  "Connais-tu le numéro de téléphone contre le harcèlement 3018 ?",
  "Si oui, as-tu déjà appelé ou as-tu eu l'intention de le faire ?",
  "As-tu déjà, avec d'autres élèves, embêté un(e) autre élève en te moquant de lui ou d'elle, en répétant des rumeurs à son sujet, en le ou la bousculant ou en le ou la mettant à l'écart ?",
  "Connais-tu un(e) élève harcélé(e) dans ton établissement ?",
  "Connais-tu un(e) élève harcelé(e) dans ta classe ?"
];
    function startQuestionnaire() {
      document.getElementById('welcome').style.display = 'none';
      document.getElementById('questionnaireForm').style.display = 'block';
    }
    function renderQuestions() {
      const container = document.getElementById('questions');
      container.innerHTML = "";
      // Questions Oui/Non : les 4 dernières
      const yesNoOptional = [35, 36, 37, 38];
      const yesNoRequired = [39, 40, 41, 42, 43, 44];
      
      questionsText.forEach((question, index) => {
        if (index === 0) {
          const sub1 = document.createElement('div');
          sub1.className = 'subgroup-title';
          sub1.textContent = "Comment te sens-tu ?";
          container.appendChild(sub1);
        } else if (index === 13) {
          const sub2 = document.createElement('div');
          sub2.className = 'subgroup-title';
          sub2.textContent = "Comment cela se passe-t-il avec les autres élèves ?";
          container.appendChild(sub2);
          } else if (index === 34) {
          const sub3 = document.createElement('div');
          sub3.className = 'subgroup-title';
          sub3.textContent = "Si tu as l’impression d’être embêté(e) souvent dans ton établissement scolaire ou sur Internet :";
          container.appendChild(sub3);
          } else if (index === 38) {
          const sub4 = document.createElement('div');
          sub4.className = 'subgroup-title';
          sub4.textContent = "Pour en savoir plus :";
          container.appendChild(sub4);
        }
        const div = document.createElement('div');
        div.className = 'question';
        const label = document.createElement('label');
        label.textContent = `${index + 1}. ${question}`;
        div.appendChild(label);
        const responses = document.createElement('div');
        responses.className = 'responses';

        if (yesNoOptional.includes(index + 1) || yesNoRequired.includes(index + 1)) {
          ["Oui", "Non"].forEach(val => {
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = `q${index + 1}`;
            input.value = val;
            if (yesNoRequired.includes(index + 1)) input.required = true;
            const lbl = document.createElement('label');
            lbl.textContent = val;
            lbl.prepend(input);
            responses.appendChild(lbl);
          });
        } else {
        for (let i = 1; i <= 4; i++) {
          const input = document.createElement('input');
          input.type = 'radio';
          input.name = `q${index + 1}`;
          input.value = i;
          input.required = true;
          const lbl = document.createElement('label');
          lbl.textContent = i;
          lbl.prepend(input);
          responses.appendChild(lbl);
        }
      }
        div.appendChild(responses);
        container.appendChild(div);
      });
    }
    document.getElementById('questionnaireForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {};
      formData.forEach((value, key) => {
        data[key] = value;
      });
      await fetch('/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      document.getElementById('questionnaireForm').style.display = 'none';
      document.getElementById('finalMessage').style.display = 'block';
    });
    renderQuestions();
  </script>
</body>
</html>
